<div class="row body-container" has-permissions="['EVENT_ADMINISTRATION']">
    <div class="col-xs-12">
        <div class="panel panel-default events-panel">
            <!-- Header -->
            <div class="panel-heading" ng-if="!vm.areFiltersLoading">
                <span>{{vm.eventDetails.name}}</span>
                <ace-filter-preset
                    ng-if="!vm.areFiltersLoading"
                    filter-page-type="{{vm.filterPageType}}"
                    loaded-filter-types="vm.filterTypes"
                    on-value-change="vm.applyFilterPreset(preset)"
                    class="pull-right"
                    modal-size="lg"
                    ng-class="{ 'hidden' : vm.isLoading && !vm.eventDetails }"
                ></ace-filter-preset>
            </div>

            <wave-spinner ng-if="vm.isLoading && !vm.eventDetails"></wave-spinner>

            <div class="panel-body">
                <!-- Content -->
                <div class="event-description-body">
                    <div class="row" ng-if="!vm.isLoading || vm.eventDetails">

                        <div class="col-xs-12 col-sm-6 col-lg-4 text-center">
                            <img class="event-details-image" alt="{{vm.eventDetails.name}}"
                                ng-src="{{vm.eventDetails.imageName | imageThumb:vm.eventImageSize:'crop'}}"
                                image-loading>
                        </div>

                        <div class="col-xs-12 col-sm-6 col-lg-3 event-details-registration-container">
                            <div class="col-xs-12 event-details-start-date text-center">
                                <span translate="events.eventStart"></span>
                            </div>
                            <div class="col-xs-12 event-details-start-time text-center" ng-cloak>
                                {{vm.eventDetails.startDate | amUtc | amLocal | amDateFormat:'HH:mm'}}
                            </div>
                            <div class="col-xs-12 event-details-start-date text-center" ng-cloak>
                                {{vm.eventDetails.startDate | amUtc | amLocal | amDateFormat:'MMMM DD'}}
                            </div>
                        </div>

                        <div class="col-xs-12 col-lg-5 event-details-info-container">
                            <div class="col-xs-12">
                                <span class="glyphicon glyphicon-clock"></span>
                                <b>
                                    <span translate="events.eventEndDate"></span>
                                    :
                                </b>
                                <span class="event-details-date" ng-cloak>
                                    {{vm.eventDetails.endDate | amUtc | amLocal | amDateFormat:'YYYY-MM-DD HH:mm'}}
                                </span>
                            </div>
                            <div class="col-xs-12">
                                <span class="glyphicon glyphicon-map-marker"></span>
                                <b>
                                    <span ng-if="vm.eventDetails.officeNames.length < 2"
                                        translate="events.eventOffice"></span>
                                    <span ng-if="vm.eventDetails.officeNames.length > 1"
                                        translate="events.eventOffices"></span>
                                    :
                                </b>
                                <span ng-cloak ng-if="!vm.eventDetails.isForAllOffices && vm.eventDetails.officeNames"
                                    ng-repeat="officeName in vm.eventDetails.officeNames">
                                    {{officeName}}{{$last ? '' :', '}}
                                </span>
                                <span ng-cloak
                                    ng-if="vm.eventDetails.isForAllOffices || !vm.eventDetails.officeNames.length">
                                    {{"events.eventForOfficeAll"
                                    | translate}}
                                </span>
                            </div>
                            <div class="col-xs-12">
                                <span class="glyphicon glyphicon-map-marker"></span>
                                <b>
                                    <span translate="events.eventLocation"></span>
                                    :
                                </b>
                                <span ng-cloak>{{vm.eventDetails.location}}</span>
                            </div>
                            <div class="col-xs-12">
                                <span class="glyphicon glyphicon-user"></span>
                                <b>
                                    <span translate="events.responsiblePerson"></span>
                                    :
                                </b>
                                <a ui-sref="Root.WithOrg.Client.Profiles.Details({ id: vm.eventDetails.hostUserId })">
                                    <span ng-cloak>
                                        {{vm.eventDetails.hostUserFullName}}
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="col-xs-12 event-details-description" ng-show="!!vm.eventDetails.description.length">
                        <p markdown ng-bind-html="vm.eventDetails.description"></p>
                    </div>
                </div>

                <!-- Filter controls -->
                <div class="row event-details-list-filter-controls" ng-if="!vm.isLoading && vm.participants.pagedList.length">
                    <ace-dropdown-checkbox
                        class="col-md-2 col-xs-6 col-sm-4 pull-right"
                        translation="events.eventKudosDropdownButtonTitle"
                        types="vm.filterTypes.kudosTypes.filters"
                        on-value-change="vm.setTypes('appliedKudos', types)"
                        applied-types="vm.dropdownCheckboxes.kudosTypes"
                        is-expanded="false">
                    </ace-dropdown-checkbox>

                    <ace-dropdown-checkbox class="col-md-2 col-xs-6 col-sm-4 pull-right"
                        translation="events.eventTypesDropdownButtonTitle"
                        types="vm.filterTypes.eventTypes.filters"
                        applied-types="vm.dropdownCheckboxes.eventTypes"
                        on-value-change="vm.setTypes('appliedEventTypes', types)"
                        is-expanded="false">
                    </ace-dropdown-checkbox>
                </div>

                <table ng-if="!vm.isLoadingParticipants && vm.participants.pagedList.length" class="nc-table">
                    <thead>
                        <tr>
                            <th translate="events.tableEmployee"></th>
                            <th translate="events.tableHireDate" class="hidden-xs hidden-sm"></th>
                            <th translate="events.tableQualification" class="hidden-xs hidden-sm hidden-md"></th>
                            <th translate="events.tablePosition" class="hidden-xs hidden-sm"></th>
                            <th translate="events.tableManager" class="hidden-xs hidden-sm"></th>
                            <th translate="events.tableKudos" class="hidden-xs hidden-sm"></th>
                            <th translate="events.tableEvents"></th>
                            <th translate="events.tableProjects" class="hidden-xs hidden-sm"></th>
                            <th class="hidden-xs hidden-sm" ng-if="vm.showActionsColumn" translate="events.tableAction">
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat-start="participant in vm.participants.pagedList" ng-click="vm.viewDetails(event.id)">
                            <td class="col-xs-2 word-break" ng-cloak>
                                <a ui-sref="Root.WithOrg.Client.Profiles.Details({ id: participant.id })">
                                    <span ng-cloak>
                                        {{participant.firstName}} {{participant.lastName}}
                                    </span>
                                </a>
                            </td>
                            <td class="col-xs-2 hidden-xs hidden-sm" ng-cloak>
                                {{participant.employmentDate | amUtc | amLocal | amDateFormat:'YYYY-MM-DD'}}
                            </td>
                            <td class="col-xs hidden-xs hidden-sm hidden-md" ng-cloak>
                                {{participant.qualificationLevel || ('events.empty' | translate) }}
                            </td>
                            <td class="col-xs-2 hidden-xs hidden-sm" ng-cloak>
                                {{participant.jobTitle || ('events.empty' | translate) }}
                            </td>
                            <td class="col-xs-2 hidden-xs hidden-sm" ng-cloak>
                                <a ui-sref="Root.WithOrg.Client.Profiles.Details({ id: participant.managerId })">
                                    <span ng-if="participant.managerFirstName" ng-cloak>
                                        {{participant.managerFirstName}} {{participant.managerLastName}}
                                    </span>
                                </a>
                                <span ng-if="!participant.managerFirstName" translate="events.empty"></span>
                            </td>

                            <!-- Kudos -->
                            <td class="col-xs hidden-xs hidden-sm" ng-cloak>
                                <a ui-sref="Root.WithOrg.Client.Kudos.KudosUserInformation({ userId: participant.id })">
                                    {{participant.kudos}}
                                </a>
                                <span ng-if="!participant.kudos" translate="events.empty"></span>
                            </td>

                            <!-- Events -->
                            <td class="col-xs-2" ng-cloak>
                                <span ng-if="!participant.visitedEvents.length" translate="events.empty"></span>
                                <ul class="event-details-event-list" ng-if="participant.visitedEvents.length">
                                    <li ng-if="!participant.isExpanded"
                                        ng-repeat="event in participant.visitedEvents | limitTo: vm.visitedEventsPreviewCount track by $index">
                                        <a
                                            ui-sref=" Root.WithOrg.Client.Events.EventContent({ id: event.id })">{{event.name}}</a>
                                        <span ng-if="participant.canBeExpanded &&
                                                        !participant.isExpanded &&
                                                        $index === vm.visitedEventsPreviewCount - 1"
                                            translate="events.moreCount" translate-values="{ one: participant.visitedEvents.length -
                                                            vm.visitedEventsPreviewCount }">
                                        </span>
                                    </li>
                                </ul>
                            </td>

                            <!-- Projects -->
                            <td class="col-xs-4 hidden-xs hidden-sm" ng-cloak>
                                <span ng-if="!participant.projects.length" translate="events.empty"></span>
                                <ul class="event-details-project-list" ng-if="participant.projects.length">
                                    <li ng-repeat="project in participant.projects">
                                        <a
                                            ui-sref=" Root.WithOrg.Client.Projects.ProjectContent({ id: project.id })">{{project.name}}</a>
                                    </li>
                                </ul>
                            </td>

                            <!-- Expand button -->
                            <td class="col-xs-1 hidden-xs hidden-sm ml-5 text-center" ng-if="vm.showActionsColumn">
                                <ace-expand-button ng-if="participant.canBeExpanded"
                                    is-expanded="participant.isExpanded"></ace-expand-button>
                            </td>
                        </tr>

                        <!-- Additional row for displaying participated events -->
                        <tr ng-repeat-end ng-if="participant.isExpanded">
                            <td colspan="9" class="no-padding">
                                <!-- Expansion content -->
                                <table class="nc-table event-details-extension-table no-border">
                                    <thead>
                                        <tr>
                                            <th translate="events.tableTitle" class="col-xs-3"></th>
                                            <th translate="events.tableType" class="col-xs-2"></th>
                                            <th translate="events.tableStartDate" class="hidden-xs hidden-sm"></th>
                                            <th translate="events.tableEndDate" class="hidden-xs hidden-sm"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="event in participant.visitedEvents">
                                            <td class="col-xs-2 col-sm-4" style="word-break: break-word;">
                                                <a
                                                    ui-sref=" Root.WithOrg.Client.Events.EventContent({ id: event.id })">{{event.name}}</a>
                                            </td>
                                            <td class="col-xs-2">{{event.typeName}}</td>
                                            <td class="hidden-xs hidden-sm">
                                                {{event.startDate | amUtc | amLocal | amDateFormat:'YYYY-MM-DD HH-MM'}}
                                            </td>
                                            <td class="hidden-xs hidden-sm">
                                                {{event.endDate | amUtc | amLocal | amDateFormat:'YYYY-MM-DD HH-MM'}}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <wave-spinner ng-if="vm.isLoadingParticipants"></wave-spinner>

                <ace-list-pagination
                    total-item-count="vm.participants.itemCount"
                    page-size="vm.participants.pageSize"
                    page-count="vm.participants.pageCount"
                    current-page="vm.page"
                    on-changed="vm.loadParticipantsOnPage(page)">
                </ace-list-pagination>
            </div>
        </div>
    </div>
</div>
